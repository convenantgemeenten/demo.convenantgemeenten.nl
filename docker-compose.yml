version: '3.7'
services:
  weddingplanner:
      container_name: weddingplanner
      image: broersen/weddingplanner-service:latest
      restart: always
      ports:
        - '8081'
      environment:
        - "WEDDING_CONFIG=/home/librarian/conf/application.conf"
      volumes:
        - ./config/weddingplanner:/home/librarian/conf:ro
        - ./.data/weddingplanner:/home/librarian/graph
      networks:
        - backend
  agetest-service:
      container_name: agetest-service
      image: convenantgemeenten/agetest-service:latest
      restart: always
      ports:
        - '8080'
      environment:
        - "AGETEST_CONFIGS_PATH=/home/librarian/conf/"
      volumes:
        - ./config/agetest:/home/librarian/conf:ro
        - ./.data/agetest:/home/librarian/graph
      networks:
        - backend
  kinsmantest-service:
      container_name: kinsmantest-service
      image: convenantgemeenten/kinsmantest-service:latest
      restart: always
      ports:
        - '8080'
      environment:
        - "KINSMANTEST_CONFIGS_PATH=/home/librarian/conf/"
      volumes:
        - ./config/kinsmantest:/home/librarian/conf:ro
        - ./.data/kinsmantest:/home/librarian/graph
      networks:
        - backend
  nginx:
    depends_on:
      - agetest-service
      - kinsmantest-service
      - weddingplanner
    image: nginx:latest
    restart: always
    ports:
        - "80:80"
        - "443:443"
    volumes:
        - ./nginx.conf:/etc/nginx/conf.d/default.conf
    networks:
      - frontend
      - backend

networks:
  frontend:
  backend:
